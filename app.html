<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ArdayCaawiye - Complete CMS</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">

    <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
    <script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@yaireo/tagify"></script>
    <link href="https://cdn.jsdelivr.net/npm/@yaireo/tagify/dist/tagify.css" rel="stylesheet" type="text/css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>

    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f3f4f6; /* gray-100 */ } /* Added background color */
        .sidebar-link { display: flex; align-items: center; padding: 0.75rem 1rem; border-radius: 0.5rem; color: #d1d5db; font-weight: 500; transition: background-color 0.2s, color 0.2s; }
        .sidebar-link:hover { background-color: #374151; color: white; }
        .sidebar-link.active { background-color: #4f46e5; color: white; font-weight: 600; }
        .sidebar-link .icon { width: 1.125rem; height: 1.125rem; margin-right: 0.75rem; flex-shrink: 0; }
        .dropdown-menu { display: none; padding-left: 1.5rem; /* pl-6 */ }
        .sidebar-link.has-dropdown.open + .dropdown-menu { display: block; }
        .sidebar-link.has-dropdown.open .dropdown-icon { transform: rotate(180deg); }
        .dropdown-menu .sidebar-link { padding-top: 0.5rem; padding-bottom: 0.5rem; font-size: 0.875rem; }
        .dropdown-menu .sidebar-link:hover { background-color: #374151; }
        .dropdown-menu .sidebar-link.active { color: #a5b4fc; background-color: transparent; font-weight: 500; }
        .fade-in { animation: fadeIn 0.3s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        /* Quiz Modal Styles */
        .quiz-modal-overlay { position: fixed; inset: 0; background-color: rgba(0, 0, 0, 0.6); display: flex; align-items: center; justify-content: center; z-index: 100; overflow-y: auto; padding: 2rem 1rem; }
        .quiz-modal-container { background-color: white; border-radius: 1rem; box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25); width: 100%; max-width: 56rem; margin: auto; max-height: 95vh; display: flex; flex-direction: column; overflow: hidden; }
        #quiz-form { overflow-y: auto; }
        .quiz-form-input, .quiz-form-select { width: 100%; border: 1px solid #d1d5db; border-radius: 0.5rem; padding: 0.65rem 1rem; font-size: 0.875rem; transition: border-color 0.2s, box-shadow 0.2s; }
        .quiz-form-input:focus, .quiz-form-select:focus { outline: none; border-color: #4f46e5; box-shadow: 0 0 0 2px #c7d2fe; }
        .quiz-btn { padding: 0.65rem 1.25rem; border-radius: 0.5rem; font-weight: 600; transition: all 0.2s; display: inline-flex; align-items: center; justify-content: center; }
        .quiz-btn-primary { background-color: #4f46e5; color: white; }
        .quiz-btn-primary:hover { background-color: #4338ca; }
        .quiz-btn-secondary { background-color: #f3f4f6; color: #374151; border: 1px solid #d1d5db; }
        .quiz-btn-secondary:hover { background-color: #e5e7eb; }
        .quiz-btn-danger { background-color: #dc2626; color: white; }
        .quiz-btn-danger:hover { background-color: #b91c1c; }
        .quiz-fab { position: fixed; bottom: 2rem; right: 2rem; width: 4rem; height: 4rem; border-radius: 9999px; z-index: 40; }
        .quiz-fab .fa-solid { font-size: 1.5rem; }
        .radio-custom { appearance: none; width: 1.25rem; height: 1.25rem; border: 2px solid #94a3b8; border-radius: 50%; transition: all 0.2s; cursor: pointer; margin-right: 0.5rem; flex-shrink: 0; }
        .radio-custom:checked { border-color: #1d4ed8; background-color: #1d4ed8; background-image: url("data:image/svg+xml,%3csvg viewBox='0 0 16 16' fill='white' xmlns='http://www.w3.org/2000/svg'%3e%3ccircle cx='8' cy='8' r='3'/%3e%3c/svg%3e"); }
        /* User/Confirm Modal Styles */
        .user-modal-backdrop { position: fixed; inset: 0; background-color: rgba(0, 0, 0, 0.5); display: flex; align-items: center; justify-content: center; z-index: 60; display: none; /* Hidden by default */ }
        /* Blog-specific Styles */
        .app-view { display: none; } /* Used for Blog sections */
        .app-view.active { display: block; }
        .modal { position: fixed; inset: 0; background-color: rgba(0, 0, 0, 0.6); display: flex; align-items: center; justify-content: center; z-index: 100; overflow-y: auto; padding: 1rem; display: none; /* Hidden by default - Used by Blog Modals */ }
        .modal-content { animation: fadeIn 0.2s ease-out; }
        #quill-editor { height: 400px; }
        .tagify { --tags-border-color: #d1d5db; border-radius: 0.5rem; }
        .tagify:hover { --tags-border-color: #4f46e5; }
        .tagify.tagify--focus { --tags-border-color: #4f46e5; }
        /* Toast */
        #toast { position: fixed; bottom: 20px; right: 20px; padding: 1rem 1.5rem; border-radius: 0.5rem; color: white; z-index: 1000; opacity: 0; visibility: hidden; transform: translateY(20px); transition: all 0.3s ease-in-out; font-weight: 600; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        #toast.show { opacity: 1; visibility: visible; transform: translateY(0); }
        .toast-success { background-color: #10b981; }
        .toast-error { background-color: #ef4444; }
        /* Action Button Style */
        .action-btn { padding: 0.25rem 0.5rem; border-radius: 0.375rem; transition: background-color 0.2s; font-size: 0.875rem; display: inline-flex; align-items: center; }
    </style>
</head>
<body class="flex h-screen overflow-hidden">

    <div id="login-page" class="w-full h-full flex items-center justify-center bg-gray-100">
        <div class="w-full max-w-md p-8 space-y-6 bg-white rounded-xl shadow-lg m-4">
            <div><h2 id="auth-title" class="text-center text-3xl font-extrabold text-gray-900">Sign in to your account</h2></div>
            <form id="auth-form" class="space-y-6">
                <div><label for="email" class="sr-only">Email address</label><input id="email" name="email" type="email" autocomplete="email" required class="appearance-none rounded-md relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 focus:z-10 sm:text-sm" placeholder="Email address" value="dausfilms@gmail.com"></div>
                <div><label for="password" class="sr-only">Password</label><input id="password" name="password" type="password" autocomplete="current-password" required class="appearance-none rounded-md relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 focus:z-10 sm:text-sm" placeholder="Password" value="siciid23"></div>
                <div><button id="auth-submit-btn" type="submit" class="group relative w-full flex justify-center py-2 px-4 border border-transparent text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">Sign in</button></div>
            </form>
            <p class="text-center text-sm text-gray-600"><a href="#" id="auth-toggle-link" class="font-medium text-indigo-600 hover:text-indigo-500">Don't have an account? Sign up</a></p>
        </div>
    </div>

    <div id="main-app" class="flex w-full h-full hidden">

        <aside id="sidebar" class="w-64 bg-gray-800 text-white flex flex-col fixed h-full z-30 transform -translate-x-full md:translate-x-0 transition-transform duration-300 ease-in-out">
            <div class="p-5 text-2xl font-bold border-b border-gray-700 flex items-center"> <img src="https://firebasestorage.googleapis.com/v0/b/ardaycaawiye-18b89.appspot.com/o/logo.png?alt=media&token=5b34de54-86a0-47e1-8848-033190897645" alt="Logo" class="h-8 mr-2"> <span>ArdayCaawiye</span> </div>
            <nav class="flex-1 p-3 space-y-1.5 overflow-y-auto">
                <a href="#" class="sidebar-link active" data-tab="dashboard"> <i data-lucide="home" class="icon"></i> Dashboard </a>
                <div class="pt-2">
                    <button class="sidebar-link has-dropdown w-full"> <i data-lucide="folder-kanban" class="icon"></i> <span class="flex-1 text-left">Manage Content</span> <i data-lucide="chevron-down" class="icon dropdown-icon w-4 h-4 ml-auto transition-transform"></i> </button>
                    <ul class="dropdown-menu space-y-1 pt-1">
                        <li><a href="#" class="sidebar-link" data-tab="subjects"><i data-lucide="book-copy" class="icon"></i> Subjects</a></li>
                        <li><a href="#" class="sidebar-link" data-tab="exams"><i data-lucide="file-check-2" class="icon"></i> Exams</a></li>
                        <li><a href="#" class="sidebar-link" data-tab="quizzes"><i data-lucide="puzzle" class="icon"></i> Quizzes</a></li>
                        <li><a href="#" class="sidebar-link" data-tab="generalBooks"><i data-lucide="book-open" class="icon"></i> General Books</a></li>
                        <li><a href="#" class="sidebar-link" data-tab="pdf-library"><i data-lucide="library" class="icon"></i> File Library</a></li>
                    </ul>
                </div>
                <div class="pt-2">
                    <button class="sidebar-link has-dropdown w-full"> <i data-lucide="newspaper" class="icon"></i> <span class="flex-1 text-left">Blog Management</span> <i data-lucide="chevron-down" class="icon dropdown-icon w-4 h-4 ml-auto transition-transform"></i> </button>
                    <ul class="dropdown-menu space-y-1 pt-1">
                        <li><a href="#" class="sidebar-link" data-tab="list-posts"><i data-lucide="layout-list" class="icon"></i> All Posts</a></li>
                        <li><a href="#" class="sidebar-link" data-tab="post-form-view" data-action="add"><i data-lucide="plus-square" class="icon"></i> Add New Post</a></li>
                        <li><a href="#" class="sidebar-link" data-tab="categories"><i data-lucide="tag" class="icon"></i> Categories</a></li>
                        <li><a href="#" class="sidebar-link" data-tab="comments"><i data-lucide="messages-square" class="icon"></i> Comments</a></li>
                        <li><a href="#" class="sidebar-link" data-tab="analytics"><i data-lucide="bar-chart-3" class="icon"></i> Analytics</a></li>
                    </ul>
                </div>
                <div class="pt-2">
                    <button class="sidebar-link has-dropdown w-full"> <i data-lucide="users" class="icon"></i> <span class="flex-1 text-left">User Management</span> <i data-lucide="chevron-down" class="icon dropdown-icon w-4 h-4 ml-auto transition-transform"></i> </button>
                    <ul class="dropdown-menu space-y-1 pt-1">
                        <li><a href="#" class="sidebar-link" data-tab="users-students"><i data-lucide="user" class="icon"></i> Students / Members</a></li>
                        <li><a href="#" class="sidebar-link" data-tab="users-roles"><i data-lucide="shield-check" class="icon"></i> Roles & Permissions</a></li>
                    </ul>
                </div>
                <div class="pt-2">
                    <button class="sidebar-link has-dropdown w-full"> <i data-lucide="bar-chart-3" class="icon"></i> <span class="flex-1 text-left">Reports & Analytics</span> <i data-lucide="chevron-down" class="icon dropdown-icon w-4 h-4 ml-auto transition-transform"></i> </button>
                    <ul class="dropdown-menu space-y-1 pt-1">
                        <li><a href="#" class="sidebar-link" data-tab="main-report"><i data-lucide="activity" class="icon"></i> Main Report</a></li>
                    </ul>
                </div>
                <a href="#" class="sidebar-link" data-tab="settings"> <i data-lucide="settings" class="icon"></i> Settings </a>
            </nav>
            <div class="p-4 border-t border-gray-700">
                <div id="auth-status" class="text-xs text-gray-400 truncate mb-2">Not Authenticated</div>
                <button id="logout-btn" class="w-full flex items-center justify-center p-2 rounded-lg bg-red-600 hover:bg-red-700 transition-colors text-white font-medium text-sm"> <i data-lucide="log-out" class="w-4 h-4 mr-2"></i> Logout </button>
            </div>
        </aside>

        <div id="sidebar-overlay" class="fixed inset-0 bg-black bg-opacity-50 z-20 md:hidden hidden"></div>

        <div class="md:hidden flex justify-between items-center bg-white p-4 border-b fixed top-0 left-0 right-0 z-10"> <span class="text-xl font-bold text-gray-800">ArdayCaawiye CMS</span> <button id="mobile-menu-btn" class="text-gray-800"> <i data-lucide="menu" class="w-6 h-6"></i> </button> </div>

        <main class="flex-1 ml-0 md:ml-64 pt-20 md:pt-4 p-4 md:p-8 overflow-y-auto bg-gray-50">
            <div id="dashboard" class="tab-content fade-in">
                <h1 class="text-3xl font-bold text-gray-800 mb-6">Dashboard Overview</h1>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                    <div class="bg-white p-6 rounded-xl shadow-md flex items-center"><div class="bg-indigo-100 p-4 rounded-full mr-4"><i data-lucide="book-copy" class="w-8 h-8 text-indigo-600"></i></div><div><p class="text-gray-500">Total Subjects</p><p id="total-subjects" class="text-3xl font-bold">0</p></div></div>
                    <div class="bg-white p-6 rounded-xl shadow-md flex items-center"><div class="bg-green-100 p-4 rounded-full mr-4"><i data-lucide="file-check-2" class="w-8 h-8 text-green-600"></i></div><div><p class="text-gray-500">Total Exams</p><p id="total-exams" class="text-3xl font-bold">0</p></div></div>
                    <div class="bg-white p-6 rounded-xl shadow-md flex items-center"><div class="bg-amber-100 p-4 rounded-full mr-4"><i data-lucide="book-open" class="w-8 h-8 text-amber-600"></i></div><div><p class="text-gray-500">Total Books</p><p id="total-books" class="text-3xl font-bold">0</p></div></div>
                    <div class="bg-white p-6 rounded-xl shadow-md flex items-center"><div class="bg-sky-100 p-4 rounded-full mr-4"><i data-lucide="puzzle" class="w-8 h-8 text-sky-600"></i></div><div><p class="text-gray-500">Total Quizzes</p><p id="total-quizzes" class="text-3xl font-bold">0</p></div></div>
                </div>
                 <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mt-6">
                    <div class="bg-white p-6 rounded-xl shadow-md flex items-center"><div class="bg-blue-100 p-4 rounded-full mr-4"><i data-lucide="users" class="w-8 h-8 text-blue-600"></i></div><div><p class="text-gray-500">Total Users</p><p id="dash-total-users" class="text-3xl font-bold">0</p></div></div>
                    <div class="bg-white p-6 rounded-xl shadow-md flex items-center"><div class="bg-emerald-100 p-4 rounded-full mr-4"><i data-lucide="user-check" class="w-8 h-8 text-emerald-600"></i></div><div><p class="text-gray-500">Paid Users</p><p id="dash-paid-users" class="text-3xl font-bold">0</p></div></div>
                    <div class="bg-white p-6 rounded-xl shadow-md flex items-center"><div class="bg-rose-100 p-4 rounded-full mr-4"><i data-lucide="user-x" class="w-8 h-8 text-rose-600"></i></div><div><p class="text-gray-500">Banned Users</p><p id="dash-banned-users" class="text-3xl font-bold">0</p></div></div>
                    <div class="bg-white p-6 rounded-xl shadow-md flex items-center"><div class="bg-purple-100 p-4 rounded-full mr-4"><i data-lucide="wallet" class="w-8 h-8 text-purple-600"></i></div><div><p class="text-gray-500">Total Revenue</p><p id="dash-total-revenue" class="text-3xl font-bold">$0</p></div></div>
                </div>
            </div>
            <div id="subjects" class="tab-content fade-in hidden">
                <div class="bg-white rounded-xl shadow-md p-6"> </div>
            </div>
            <div id="exams" class="tab-content fade-in hidden">
                 <div class="bg-white rounded-xl shadow-md p-6"> </div>
            </div>
            <div id="quizzes" class="tab-content fade-in hidden">
                <header class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-8 gap-4">
                    <div> <h1 class="text-4xl font-extrabold text-gray-900 tracking-tight">Quiz Manager 💡</h1> <p class="text-gray-500 mt-1">Create, edit, and organize your educational content.</p> </div>
                </header>
                <div class="bg-white rounded-xl shadow-md p-4 mb-8 border border-gray-100">
                    <label for="subject-filter" class="block text-sm font-semibold text-gray-700 mb-2">Filter Quizzes by Subject</label>
                    <select id="subject-filter" class="quiz-form-select text-gray-700"> <option value="all">All Subjects</option> </select>
                </div>
                <div id="quiz-list-container" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6"> </div>
                <div id="pagination-container" class="mt-10 flex justify-center items-center gap-2"></div>
                <button id="add-quiz-fab" class="quiz-btn quiz-btn-primary quiz-fab shadow-xl" title="Add New Quiz"> <i class="fa-solid fa-plus text-xl"></i> </button>
            </div>
            <div id="generalBooks" class="tab-content fade-in hidden">
                <div class="bg-white rounded-xl shadow-md p-6"> </div>
            </div>
            <div id="pdf-library" class="tab-content fade-in hidden">
                <h1 class="text-3xl font-bold text-gray-800 mb-6">File Library</h1>
                <div class="bg-white rounded-xl shadow-md p-6">
                    <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-4 gap-4">
                        <h2 class="text-xl font-semibold">All Uploaded Files (PDF, ZIP, Images)</h2>
                        <div> <input type="file" id="pdf-upload-input" multiple accept=".pdf,.zip,.png,.jpg,.jpeg,.webp" class="hidden"> <button id="upload-pdf-btn" class="bg-indigo-600 text-white px-4 py-2 rounded-lg font-medium hover:bg-indigo-700 transition-colors flex items-center w-full md:w-auto"><i data-lucide="upload" class="w-4 h-4 mr-2"></i>Upload Files</button> </div>
                    </div>
                    <div id="upload-progress-container" class="hidden my-4"><div class="text-sm font-medium text-gray-700 mb-1">Uploading...</div><div class="w-full bg-gray-200 rounded-full h-2.5"><div id="upload-progress-bar" class="bg-indigo-600 h-2.5 rounded-full" style="width: 0%"></div></div></div>
                    <div class="mb-4 flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
                        <input type="text" id="pdf-search" placeholder="Search files by name..." class="w-full md:w-1/2 p-2 border border-gray-300 rounded-lg">
                        <button id="delete-selected-pdfs-btn" class="bg-red-600 text-white px-4 py-2 rounded-lg font-medium hover:bg-red-700 transition-colors flex items-center hidden w-full md:w-auto"><i data-lucide="trash-2" class="w-4 h-4 mr-2"></i>Delete Selected (0)</button>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="w-full text-left">
                            <thead class="bg-gray-50"> <tr> <th class="p-3 w-8"><input type="checkbox" id="select-all-pdfs"></th> <th class="p-3 font-semibold text-sm">File Name</th> <th class="p-3 font-semibold text-sm">Size</th> <th class="p-3 font-semibold text-sm">Upload Date</th> <th class="p-3 font-semibold text-sm">Actions</th> </tr> </thead>
                            <tbody id="pdf-list-table"> <tr><td colspan="5" class="p-6 text-center text-gray-500">Loading files...</td></tr> </tbody>
                        </table>
                    </div>
                </div>
            </div>
            <div id="list-posts" class="tab-content fade-in hidden app-view">
                 <div class="flex justify-between items-center mb-6"> <h1 class="text-3xl font-bold text-gray-800">All Posts</h1> <button id="add-new-post-btn-main" class="bg-indigo-600 text-white px-4 py-2 rounded-lg font-semibold flex items-center hover:bg-indigo-700 transition-colors"> <i data-lucide="plus" class="w-5 h-5 mr-2"></i> Add New Post </button> </div>
                <div class="bg-white p-4 rounded-lg shadow-sm mb-6"> <div class="grid grid-cols-1 md:grid-cols-4 gap-4"> <input type="text" id="search-posts" placeholder="Search posts..." class="md:col-span-2 w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"> <select id="filter-category" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"> <option value="">All Categories</option> </select> <select id="filter-status" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"> <option value="">All Statuses</option> <option value="Published">Published</option> <option value="Draft">Draft</option> <option value="Scheduled">Scheduled</option> </select> </div> </div>
                <div class="bg-white rounded-lg shadow-sm overflow-hidden"> <div class="overflow-x-auto"> <table class="w-full"> <thead class="bg-gray-50 border-b border-gray-200"> <tr> <th class="p-4 w-12 text-left"><input type="checkbox" id="select-all-posts"></th> <th class="p-4 text-left text-sm font-semibold text-gray-600 uppercase tracking-wider">Title</th> <th class="p-4 text-left text-sm font-semibold text-gray-600 uppercase tracking-wider">Author</th> <th class="p-4 text-left text-sm font-semibold text-gray-600 uppercase tracking-wider">Category</th> <th class="p-4 text-left text-sm font-semibold text-gray-600 uppercase tracking-wider">Status</th> <th class="p-4 text-left text-sm font-semibold text-gray-600 uppercase tracking-wider">Published</th> <th class="p-4 text-left text-sm font-semibold text-gray-600 uppercase tracking-wider">Actions</th> </tr> </thead> <tbody id="posts-table-body" class="divide-y divide-gray-200"> <tr><td colspan="7" class="p-8 text-center text-gray-500">Loading posts...</td></tr> </tbody> </table> </div> </div>
            </div>
            <div id="post-form-view" class="tab-content fade-in hidden app-view">
                <h1 id="form-title" class="text-3xl font-bold text-gray-800 mb-6">Add New Post</h1>
                <form id="blog-post-form"> <input type="hidden" id="post-id"> <div class="grid grid-cols-1 lg:grid-cols-3 gap-6"> <div class="lg:col-span-2 space-y-6"> <div class="bg-white p-6 rounded-lg shadow-sm"> <label for="post-title" class="block text-lg font-semibold text-gray-700 mb-2">Title</label> <input type="text" id="post-title" placeholder="Your Post Title" class="w-full text-2xl font-bold px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500" required> </div> <div class="bg-white rounded-lg shadow-sm overflow-hidden"> <div class="p-6 border-b"><label class="block text-lg font-semibold text-gray-700">Content</label></div> <div id="quill-editor"></div> </div> <div class="bg-white p-6 rounded-lg shadow-sm"> <label class="block text-lg font-semibold text-gray-700 mb-2">Attachments</label> <div id="attachment-dropzone" class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center cursor-pointer hover:border-indigo-500 bg-gray-50"> <i data-lucide="paperclip" class="w-10 h-10 mx-auto text-gray-400"></i> <p class="mt-2 text-gray-500">Drop files (PDF, ZIP, etc.) here or click to upload</p> <input type="file" class="hidden" id="post-attachments" multiple> </div> <div id="attachment-list" class="mt-4 space-y-2"></div> </div> <details class="bg-white rounded-lg shadow-sm"> <summary class="p-6 cursor-pointer text-lg font-semibold text-gray-700 flex justify-between items-center">SEO Metadata (Optional)<i data-lucide="chevron-down" class="w-5 h-5 transform transition-transform"></i></summary> <div class="p-6 border-t space-y-4"> <div><label for="seo-title" class="block text-sm font-medium text-gray-700">Meta Title</label><input type="text" id="seo-title" class="mt-1 w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"></div> <div><label for="seo-description" class="block text-sm font-medium text-gray-700">Meta Description</label><textarea id="seo-description" rows="3" class="mt-1 w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"></textarea></div> <div><label for="seo-keywords" class="block text-sm font-medium text-gray-700">Keywords (comma-separated)</label><input type="text" id="seo-keywords" class="mt-1 w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"></div> </div> </details> </div> <div class="lg:col-span-1 space-y-6"> <div class="bg-white p-6 rounded-lg shadow-sm"> <h2 class="text-lg font-semibold text-gray-700 mb-4 border-b pb-3">Publish</h2> <div class="space-y-4"> <div><label for="post-status" class="block text-sm font-medium text-gray-700">Status</label><select id="post-status" class="mt-1 w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"><option value="Draft">Draft</option><option value="Published">Published</option><option value="Scheduled">Scheduled</option></select></div> <div id="schedule-date-wrapper" class="hidden"><label for="post-schedule-date" class="block text-sm font-medium text-gray-700">Schedule Date</label><input type="text" id="post-schedule-date" placeholder="Select date and time" class="mt-1 w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"></div> </div> <div class="flex justify-between items-center mt-6 pt-4 border-t"><button type="button" id="save-draft-btn" class="text-gray-600 font-medium hover:text-indigo-600">Save Draft</button><button type="submit" id="publish-btn" class="bg-indigo-600 text-white px-5 py-2 rounded-lg font-semibold hover:bg-indigo-700 transition-colors">Publish</button></div> </div> <div class="bg-white p-6 rounded-lg shadow-sm"> <h2 class="text-lg font-semibold text-gray-700 mb-4">Category</h2> <select id="post-category" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"><option value="Uncategorized">Uncategorized</option></select> </div> <div class="bg-white p-6 rounded-lg shadow-sm"> <h2 class="text-lg font-semibold text-gray-700 mb-4">Tags</h2> <input id="post-tags" placeholder="Add tags..."> </div> <div class="bg-white p-6 rounded-lg shadow-sm"> <h2 class="text-lg font-semibold text-gray-700 mb-4">Feature Image</h2> <div id="image-dropzone" class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center cursor-pointer hover:border-indigo-500 bg-gray-50"><i data-lucide="image" class="w-10 h-10 mx-auto text-gray-400"></i><p class="mt-2 text-gray-500">Drop image here or click to upload</p><input type="file" class="hidden" id="post-image" accept="image/*"></div> <div id="image-preview-wrapper" class="mt-4 hidden"><img id="image-preview" src="#" alt="Image Preview" class="w-full h-auto rounded-lg"><button type="button" id="remove-image-btn" class="mt-2 text-sm text-red-600 hover:text-red-800">Remove Image</button></div> </div> </div> </div> </form>
            </div>
            <div id="categories" class="tab-content fade-in hidden app-view">
                 <h1 class="text-3xl font-bold text-gray-800 mb-6">Manage Categories</h1>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6"> <div class="md:col-span-1"> <form id="add-category-form" class="bg-white p-6 rounded-lg shadow-sm"> <h2 class="text-lg font-semibold text-gray-700 mb-4">Add New Category</h2> <div><label for="new-category-name" class="block text-sm font-medium text-gray-700">Category Name</label><input type="text" id="new-category-name" class="mt-1 w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500" required></div> <button type="submit" id="add-category-btn" class="mt-4 w-full bg-indigo-600 text-white px-4 py-2 rounded-lg font-semibold hover:bg-indigo-700 transition-colors">Add Category</button> </form> </div> <div class="md:col-span-2"> <div class="bg-white rounded-lg shadow-sm"> <h2 class="text-lg font-semibold text-gray-700 p-6 border-b">Existing Categories</h2> <ul id="categories-list" class="divide-y divide-gray-200"><li class="p-6 text-center text-gray-500">Loading categories...</li></ul> </div> </div> </div>
            </div>
            <div id="comments" class="tab-content fade-in hidden app-view">
                <h1 class="text-3xl font-bold text-gray-800 mb-6">Manage Comments</h1>
                <div class="bg-white p-4 rounded-lg shadow-sm mb-6"> <div class="grid grid-cols-1 md:grid-cols-3 gap-4"> <input type="text" id="search-comments" placeholder="Search comments or author..." class="md:col-span-2 w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"> <select id="filter-comment-status" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"> <option value="">All Statuses</option><option value="Pending">Pending</option><option value="Approved">Approved</option><option value="Spam">Spam</option> </select> </div> </div>
                <div id="comments-list" class="space-y-6"> <div class="bg-white p-6 rounded-lg shadow-sm text-center text-gray-500">Loading comments...</div> </div>
            </div>
            <div id="analytics" class="tab-content fade-in hidden app-view">
                <h1 class="text-3xl font-bold text-gray-800 mb-6">Blog Analytics</h1>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8"> <div class="bg-white p-6 rounded-lg shadow-sm"><div class="flex items-center justify-between"><p class="text-sm font-medium text-gray-500">Total Posts</p><i data-lucide="file-text" class="w-5 h-5 text-indigo-500"></i></div><p id="stats-total-posts" class="text-3xl font-bold text-gray-800 mt-2">0</p></div> <div class="bg-white p-6 rounded-lg shadow-sm"><div class="flex items-center justify-between"><p class="text-sm font-medium text-gray-500">Total Views</p><i data-lucide="eye" class="w-5 h-5 text-green-500"></i></div><p id="stats-total-views" class="text-3xl font-bold text-gray-800 mt-2">0</p></div> <div class="bg-white p-6 rounded-lg shadow-sm"><div class="flex items-center justify-between"><p class="text-sm font-medium text-gray-500">Pending Comments</p><i data-lucide="messages-square" class="w-5 h-5 text-yellow-500"></i></div><p id="stats-total-comments" class="text-3xl font-bold text-gray-800 mt-2">0</p></div> <div class="bg-white p-6 rounded-lg shadow-sm"><div class="flex items-center justify-between"><p class="text-sm font-medium text-gray-500">Published / Drafts</p><i data-lucide="pie-chart" class="w-5 h-5 text-blue-500"></i></div><p id="stats-published-drafts" class="text-3xl font-bold text-gray-800 mt-2">0 / 0</p></div> </div>
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6"> <div class="bg-white p-6 rounded-lg shadow-sm"><h2 class="text-xl font-semibold text-gray-800 mb-4">Popular Posts (by Views)</h2><ul id="popular-posts-list" class="divide-y divide-gray-200"><li class="py-3 text-center text-gray-500">Loading data...</li></ul></div> <div class="bg-white p-6 rounded-lg shadow-sm"><h2 class="text-xl font-semibold text-gray-800 mb-4">Views Over Time (Placeholder)</h2><div class="h-64 bg-gray-50 rounded-lg flex items-center justify-center p-4"><p class="text-gray-400 m-auto">Analytics chart here.</p></div></div> </div>
            </div>
            <div id="users-students" class="tab-content fade-in hidden">
                <h1 class="text-3xl font-bold text-gray-800 mb-6">User Management</h1>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8"> <div class="bg-white p-6 rounded-lg shadow-md flex items-center justify-between"><div><p class="text-gray-500 text-sm">Total Users</p><p id="total-users" class="text-2xl font-bold">0</p></div><div class="bg-blue-100 text-blue-500 p-3 rounded-full"><i class="fas fa-users"></i></div></div> <div class="bg-white p-6 rounded-lg shadow-md flex items-center justify-between"><div><p class="text-gray-500 text-sm">Paid Users</p><p id="paid-users" class="text-2xl font-bold">0</p></div><div class="bg-green-100 text-green-500 p-3 rounded-full"><i class="fas fa-dollar-sign"></i></div></div> <div class="bg-white p-6 rounded-lg shadow-md flex items-center justify-between"><div><p class="text-gray-500 text-sm">Not Paid Users</p><p id="not-paid-users" class="text-2xl font-bold">0</p></div><div class="bg-red-100 text-red-500 p-3 rounded-full"><i class="fas fa-exclamation-triangle"></i></div></div> <div class="bg-white p-6 rounded-lg shadow-md flex items-center justify-between"><div><p class="text-gray-500 text-sm">Total Revenue</p><p id="total-revenue" class="text-2xl font-bold">$0</p></div><div class="bg-purple-100 text-purple-500 p-3 rounded-full"><i class="fas fa-wallet"></i></div></div> </div>
                <div class="bg-white p-4 rounded-lg shadow-sm mb-6 flex flex-wrap gap-3 items-center"> <span class="text-sm font-medium text-gray-700 mr-2">Filter by:</span> <button class="user-filter-btn px-3 py-1 text-sm font-medium text-gray-700 bg-gray-100 rounded-full hover:bg-gray-200 active" data-filter="all">All</button> <button class="user-filter-btn px-3 py-1 text-sm font-medium text-green-700 bg-green-100 rounded-full hover:bg-green-200" data-filter="paid">Paid</button> <button class="user-filter-btn px-3 py-1 text-sm font-medium text-red-700 bg-red-100 rounded-full hover:bg-red-200" data-filter="not_paid">Not Paid</button> <span class="text-sm font-medium text-gray-700 ml-auto mr-2">Sort by:</span> <button class="user-sort-btn px-3 py-1 text-sm font-medium text-gray-700 bg-gray-100 rounded-full hover:bg-gray-200 active" data-sort="recent">Most Recent</button> <button class="user-sort-btn px-3 py-1 text-sm font-medium text-gray-700 bg-gray-100 rounded-full hover:bg-gray-200" data-sort="asc">Ascending (A-Z)</button> </div>
                <div class="flex flex-col md:flex-row justify-between items-center mb-6 gap-4"> <div class="relative w-full md:w-1/3"><input type="text" id="search-input" placeholder="Search by name, email, or phone..." class="w-full pl-10 pr-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"><i class="fas fa-search absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"></i></div> <button id="add-user-btn" class="w-full md:w-auto bg-blue-500 text-white px-6 py-2 rounded-lg hover:bg-blue-600 transition-colors"><i class="fas fa-plus mr-2"></i>Add User</button> </div>
                <div class="bg-white rounded-lg shadow-md overflow-x-auto"> <table class="w-full table-auto"> <thead class="bg-gray-50 border-b-2 border-gray-200"> <tr> <th class="p-4 text-left text-sm font-semibold text-gray-600">User</th> <th class="p-4 text-left text-sm font-semibold text-gray-600">Phone</th> <th class="p-4 text-left text-sm font-semibold text-gray-600">Role</th> <th class="p-4 text-left text-sm font-semibold text-gray-600">Payment</th> <th class="p-4 text-left text-sm font-semibold text-gray-600">Actions</th> </tr> </thead> <tbody id="user-table-body"> <tr><td colspan="5" class="p-6 text-center text-gray-500">Loading users...</td></tr> </tbody> </table> </div>
            </div>
            <div id="users-roles" class="tab-content fade-in hidden">
                <h1 class="text-3xl font-bold text-gray-800 mb-6">Roles & Permissions</h1>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6"> <div class="bg-white p-8 rounded-xl shadow-md"> <h2 class="text-xl font-bold text-gray-800 mb-4">Manage Roles</h2> <p class="text-gray-500 mb-4">Define custom roles and assign specific permissions.</p> <div class="space-y-2"> <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg border"> <span class="font-medium text-gray-700">Editor</span> <button class="text-sm text-indigo-600 hover:text-indigo-800">Edit Permissions</button> </div> <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg border"> <span class="font-medium text-gray-700">Moderator</span> <button class="text-sm text-indigo-600 hover:text-indigo-800">Edit Permissions</button> </div> </div> </div> <div class="bg-white p-8 rounded-xl shadow-md"> <h2 class="text-xl font-bold text-gray-800 mb-4">Administrator Accounts</h2> <p class="text-gray-500 mb-4">List of users with the 'Admin' role.</p> <div class="space-y-3" id="admin-user-list"> <p class="text-gray-500">Loading admin users...</p> </div> </div> </div>
            </div>
            <div id="main-report" class="tab-content fade-in hidden">
                <h1 class="text-3xl font-bold text-gray-800 mb-6">Main Report (Placeholder)</h1>
                <div class="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-6 gap-6 mb-8"> <div class="bg-white p-5 rounded-xl shadow-md"><p class="text-sm font-medium text-gray-500">Paid Users</p><p id="report-paid-users" class="text-3xl font-bold text-gray-800 mt-1">0</p></div> <div class="bg-white p-5 rounded-xl shadow-md"><p class="text-sm font-medium text-gray-500">PDF Views</p><p id="report-pdf-views" class="text-3xl font-bold text-gray-800 mt-1">0</p></div> <div class="bg-white p-5 rounded-xl shadow-md col-span-1 md:col-span-2 lg:col-span-2"><p class="text-sm font-medium text-gray-500">Top PDF</p><p id="report-top-pdf" class="text-2xl font-bold text-indigo-600 mt-1 truncate">N/A</p></div> <div class="bg-white p-5 rounded-xl shadow-md"><p class="text-sm font-medium text-gray-500">Blog Views</p><p id="report-blog-views" class="text-3xl font-bold text-gray-800 mt-1">0</p></div> <div class="bg-white p-5 rounded-xl shadow-md"><p class="text-sm font-medium text-gray-500">Active Users Today</p><p id="report-active-users" class="text-3xl font-bold text-gray-800 mt-1">0</p></div> </div>
                <div class="bg-white p-4 rounded-xl shadow-md mb-8 flex flex-col md:flex-row gap-4"> <div class="flex-1"><label for="report-date-range" class="block text-sm font-medium text-gray-700">Date Range</label><input type="text" id="report-date-range" class="mt-1 w-full p-2 border border-gray-300 rounded-lg" placeholder="Select date range..."></div> <div class="flex-1"><label for="report-content-type" class="block text-sm font-medium text-gray-700">Content Type</label><select id="report-content-type" class="mt-1 w-full p-2 border border-gray-300 rounded-lg"><option value="all">All</option><option value="pdf">PDFs</option><option value="blog">Blog</option></select></div> <div class="flex-1"><label for="report-subject-filter" class="block text-sm font-medium text-gray-700">Subject/Year</label><select id="report-subject-filter" class="mt-1 w-full p-2 border border-gray-300 rounded-lg"><option value="all">All</option></select></div> </div>
                <div class="grid grid-cols-1 lg:grid-cols-5 gap-6 mb-8"> <div class="lg:col-span-3 bg-white p-6 rounded-xl shadow-md"><h2 class="text-xl font-semibold text-gray-800 mb-4">Traffic (Placeholder)</h2><div class="h-80 bg-gray-50 rounded-lg flex items-center justify-center"><p class="text-gray-400">Line Chart</p></div></div> <div class="lg:col-span-2 bg-white p-6 rounded-xl shadow-md"><h2 class="text-xl font-semibold text-gray-800 mb-4">Views by Subject (Placeholder)</h2><div class="h-80 bg-gray-50 rounded-lg flex items-center justify-center"><p class="text-gray-400">Pie Chart</p></div></div> </div>
            </div>
            <div id="settings" class="tab-content fade-in hidden">
                <h1 class="text-3xl font-bold text-gray-800 mb-6">Settings</h1>
                <div class="bg-white p-8 rounded-xl shadow-md"> <p class="text-gray-500">Placeholder for application settings, API keys, etc.</p> </div>
            </div>
            </main>
    </div>

    <div id="modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50 overflow-y-auto py-10"> <div id="modal-content" class="bg-white rounded-xl shadow-2xl w-full max-w-lg p-8 m-4 fade-in"></div> </div>
    <div id="assign-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50"> <div class="bg-white rounded-xl shadow-2xl w-full max-w-3xl p-8 m-4 fade-in h-[80vh] flex flex-col"><h2 class="text-2xl font-bold mb-4">Assign File to <span id="assign-item-type" class="capitalize">Item</span></h2><p class="mb-4">Select a file below to assign to <strong id="assign-item-name"></strong>.</p><input type="text" id="assign-pdf-search" placeholder="Search available files..." class="w-full p-2 border border-gray-300 rounded-lg mb-4"><div id="assign-pdf-list-container" class="flex-1 overflow-y-auto border p-4 rounded-lg bg-gray-50"><p class="text-center text-gray-500">Loading files...</p></div><div class="mt-6 flex justify-end space-x-3"><button id="assign-modal-cancel" class="bg-gray-200 text-gray-800 px-4 py-2 rounded-lg font-medium hover:bg-gray-300">Cancel</button></div></div> </div>
    <div id="assign-pdf-to-content-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50"> <div class="bg-white rounded-xl shadow-2xl w-full max-w-3xl p-8 m-4 fade-in h-[80vh] flex flex-col"><h2 class="text-2xl font-bold mb-4">Assign File to Content</h2><p class="mb-4 truncate">Assigning file: <strong id="assign-pdf-name-display" class="text-indigo-600"></strong></p><div class="flex flex-col md:flex-row space-y-2 md:space-y-0 md:space-x-2 mb-4"><button class="assign-pdf-select-type-btn flex-1 bg-gray-100 text-gray-800 px-4 py-2 rounded-lg font-medium hover:bg-indigo-100 hover:text-indigo-700" data-type="subjects"><i data-lucide="book-copy" class="w-4 h-4 mr-2 inline-block"></i>Assign to Subject</button><button class="assign-pdf-select-type-btn flex-1 bg-gray-100 text-gray-800 px-4 py-2 rounded-lg font-medium hover:bg-indigo-100 hover:text-indigo-700" data-type="exams"><i data-lucide="file-check-2" class="w-4 h-4 mr-2 inline-block"></i>Assign to Exam</button><button class="assign-pdf-select-type-btn flex-1 bg-gray-100 text-gray-800 px-4 py-2 rounded-lg font-medium hover:bg-indigo-100 hover:text-indigo-700" data-type="generalBooks"><i data-lucide="book-open" class="w-4 h-4 mr-2 inline-block"></i>Assign to General Book</button></div><input type="text" id="assign-content-search" placeholder="Search for content..." class="w-full p-2 border border-gray-300 rounded-lg mb-4 hidden"><div id="assign-content-list-container" class="flex-1 overflow-y-auto border p-4 rounded-lg bg-gray-50"><p class="text-center text-gray-500">Please select a content type above.</p></div><div class="mt-6 flex justify-end space-x-3"><button id="assign-pdf-to-content-modal-cancel" class="bg-gray-200 text-gray-800 px-4 py-2 rounded-lg font-medium hover:bg-gray-300">Cancel</button></div></div> </div>
    <div id="quiz-modal" class="quiz-modal-overlay hidden"> <div class="quiz-modal-container"> <form id="quiz-form" class="p-6 sm:p-8"> <div class="flex justify-between items-center pb-4 border-b mb-6"> <h2 id="modal-title" class="text-3xl font-extrabold text-gray-900">Add New Quiz</h2> <div class="flex gap-3 items-center"> <button id="import-json-btn" type="button" class="quiz-btn quiz-btn-secondary text-sm" title="Import Quiz from JSON"><i class="fa-solid fa-file-import mr-1"></i> Import</button> <input type="file" id="json-file-input" accept=".json" class="hidden"> <button id="export-json-btn" type="button" class="quiz-btn quiz-btn-secondary text-sm" title="Export Quiz to JSON"><i class="fa-solid fa-file-export mr-1"></i> Export</button> <button id="close-modal-btn" type="button" class="text-gray-500 hover:text-gray-700 transition"><i class="fa-solid fa-xmark text-3xl"></i></button> </div> </div> <input type="hidden" id="quiz-id-input"> <div class="space-y-6"> <div class="grid grid-cols-1 md:grid-cols-2 gap-6"> <div><label for="quiz-title" class="block text-sm font-semibold text-gray-700 mb-1">Quiz Title*</label><input type="text" id="quiz-title" class="quiz-form-input" placeholder="e.g., The French Revolution" required></div> <div><label for="subject-select" class="block text-sm font-semibold text-gray-700 mb-1">Subject*</label><select id="subject-select" class="quiz-form-select" required><option value="">-- Select a Subject --</option></select></div> </div> <div class="p-4 rounded-xl bg-blue-50 border border-blue-200"> <label for="cover-image-input" class="block text-sm font-semibold text-blue-700 mb-2 flex items-center"><i class="fa-solid fa-image mr-2"></i> Quiz Cover Image (Optional)</label> <input type="file" id="cover-image-input" class="quiz-form-input p-2 bg-white" accept="image/*"> <p id="cover-image-filename" class="text-xs text-blue-500 mt-1 italic"></p><input type="hidden" id="cover-image-url-input"> <div id="cover-image-preview" class="mt-4 border-2 border-dashed border-blue-300 p-2 bg-white rounded-lg flex justify-center items-center h-40 overflow-hidden"><span class="text-blue-400 text-sm">Image Preview</span></div> </div> <hr class="border-gray-200"/> <h3 class="text-2xl font-bold text-gray-900 flex items-center"><i class="fa-solid fa-clipboard-question mr-2 text-gray-400"></i> Questions</h3> <div id="questions-container" class="space-y-5 max-h-[50vh] overflow-y-auto pr-3"><p class="text-gray-500 text-center py-4 text-sm" id="question-placeholder">Add question below.</p></div> <button type="button" id="add-question-btn" class="quiz-btn quiz-btn-secondary w-full text-blue-600 border-blue-300 bg-blue-100 hover:bg-blue-200"><i class="fa-solid fa-plus mr-2"></i> Add Question</button> </div> <div class="mt-8 flex flex-col sm:flex-row gap-4"> <button type="submit" id="save-quiz-btn" class="quiz-btn quiz-btn-primary flex-grow text-lg py-3"><i class="fa-solid fa-floppy-disk mr-2"></i> Save Quiz</button> <button id="delete-quiz-btn" type="button" class="quiz-btn quiz-btn-danger flex-grow hidden"><i class="fa-solid fa-trash-alt mr-2"></i> Delete Quiz</button> </div> </form> </div> </div>
    <div id="user-modal" class="user-modal-backdrop p-4"> <div class="bg-white rounded-lg shadow-xl w-full max-w-md m-4"> <div class="p-6 border-b flex justify-between items-center"><h2 id="user-modal-title" class="text-2xl font-bold">Add User</h2><button id="user-modal-close" class="text-gray-400 hover:text-gray-600"><i class="fas fa-times text-xl"></i></button></div> <div class="p-6"> <form id="user-form"> <input type="hidden" id="user-id"> <div class="mb-4"><label for="name" class="block text-sm font-medium text-gray-700">Name</label><input type="text" id="name" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"></div> <div class="mb-4"><label for="user-email" class="block text-sm font-medium text-gray-700">Email</label><input type="email" id="user-email" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"></div> <div class="mb-4"><label for="phone" class="block text-sm font-medium text-gray-700">Phone</label><div class="flex"><span class="inline-flex items-center px-3 text-sm text-gray-900 bg-gray-200 border border-r-0 border-gray-300 rounded-l-md">252</span><input type="tel" id="phone" pattern="\d{9,}" title="Phone (9+ digits, no 252)" required class="rounded-none rounded-r-lg bg-gray-50 border text-gray-900 focus:ring-blue-500 focus:border-blue-500 block flex-1 min-w-0 w-full text-sm border-gray-300 p-2.5"></div></div> <div class="flex justify-end gap-4 mt-6"><button type="button" id="cancel-btn" class="px-4 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300">Cancel</button><button type="submit" class="px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600">Save User</button></div> </form> </div> </div> </div>
    <div id="confirm-modal" class="user-modal-backdrop"> <div class="bg-white rounded-lg shadow-xl w-full max-w-sm m-4"> <div class="p-6 text-center"> <i id="confirm-icon" class="fas fa-exclamation-triangle text-4xl text-red-500 mb-4"></i> <h3 id="confirm-title" class="text-xl font-bold mb-2">Are you sure?</h3> <p id="confirm-message" class="text-gray-600 mb-6">Action cannot be undone!</p> <div class="flex justify-center gap-4"><button id="confirm-cancel-btn" class="px-6 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300">Cancel</button><button id="confirm-action-btn" class="px-6 py-2 bg-red-500 text-white rounded-lg">Yes, do it!</button></div> </div> </div> </div>
    <div id="delete-modal" class="modal"> <div class="modal-content bg-white p-8 rounded-lg shadow-2xl w-full max-w-md m-4"> <div class="text-center"> <div class="w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4"><i data-lucide="trash-2" class="w-8 h-8 text-red-600"></i></div> <h2 class="text-2xl font-bold text-gray-800 mb-2">Delete Post</h2> <p class="text-gray-600 mb-6">Delete this post & comments? Cannot be undone.</p> <div class="flex justify-center gap-4"><button id="cancel-delete-btn" class="px-6 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300 font-medium">Cancel</button><button id="confirm-delete-btn" class="px-6 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 font-medium">Delete</button></div> </div> </div> </div>
    <div id="reply-modal" class="modal"> <div class="modal-content bg-white p-8 rounded-lg shadow-2xl w-full max-w-lg m-4"> <h2 class="text-2xl font-bold text-gray-800 mb-4">Reply to Comment</h2> <div class="mb-4 bg-gray-50 p-4 rounded-lg border"><p class="text-sm font-medium text-gray-800" id="reply-author"></p><p class="text-sm text-gray-600 mt-1" id="reply-original-text"></p></div> <form id="reply-form"><input type="hidden" id="reply-comment-id"><textarea id="reply-text" rows="4" placeholder="Write reply..." class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500" required></textarea><div class="flex justify-end gap-4 mt-6"><button id="cancel-reply-btn" type="button" class="px-6 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300 font-medium">Cancel</button><button id="submit-reply-btn" type="submit" class="px-6 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 font-medium">Submit Reply</button></div></form> </div> </div>
    <div id="share-modal" class="modal"> <div class="modal-content bg-white p-8 rounded-lg shadow-2xl w-full max-w-lg m-4"> <div class="flex justify-between items-center mb-4"><h2 class="text-2xl font-bold text-gray-800">Share Post</h2><button id="cancel-share-btn" class="p-1 text-gray-500 hover:text-gray-800"><i data-lucide="x" class="w-6 h-6"></i></button></div> <p class="text-gray-600 mb-2">Share this post:</p><p class="text-lg font-semibold text-gray-800 mb-4" id="share-post-title">Post Title</p> <div class="flex items-center space-x-2"><input type="text" id="share-post-url" readonly class="w-full px-4 py-2 border border-gray-300 rounded-lg bg-gray-50 focus:outline-none"><button id="copy-url-btn" class="px-4 py-2 bg-indigo-600 text-white rounded-lg font-medium hover:bg-indigo-700 flex items-center"><i data-lucide="copy" class="w-4 h-4 mr-2"></i> Copy</button></div> <div class="flex justify-center space-x-4 mt-6"><a id="share-twitter" href="#" target="_blank" class="p-3 bg-blue-400 text-white rounded-full hover:bg-blue-500"><i data-lucide="twitter" class="w-5 h-5"></i></a><a id="share-facebook" href="#" target="_blank" class="p-3 bg-blue-600 text-white rounded-full hover:bg-blue-700"><i data-lucide="facebook" class="w-5 h-5"></i></a><a id="share-linkedin" href="#" target="_blank" class="p-3 bg-blue-700 text-white rounded-full hover:bg-blue-800"><i data-lucide="linkedin" class="w-5 h-5"></i></a></div> </div> </div>
    <div id="toast"></div> <script type="module">
    // --- CONSOLIDATED FIREBASE V10 IMPORTS ---
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getAuth, onAuthStateChanged, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
    import { getFirestore, collection, getDocs, getDoc, addDoc, doc, updateDoc, deleteDoc, onSnapshot, serverTimestamp, query, where, orderBy, writeBatch, Timestamp, setDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js"; // Added setDoc
    import { getStorage, ref, uploadBytesResumable, listAll, getDownloadURL, getMetadata, deleteObject } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-storage.js";

    // --- CONFIGURATION ---
    const firebaseConfig = { apiKey: "AIzaSyDuqswofpquk8aUbCOZCGjdYLUivBEh7a8", authDomain: "ardaycaawiye-18b89.firebaseapp.com", projectId: "ardaycaawiye-18b89", storageBucket: "ardaycaawiye-18b89.appspot.com", messagingSenderId: "590874185284", appId: "1:590874185284:web:6ee7df602c45068e38b611", measurementId: "G-SBGSTJWDMR" };

    // --- INITIALIZATION ---
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);
    const storage = getStorage(app);

    // --- GLOBAL STATE ---
    let currentUser = null;
    let currentActiveTab = 'dashboard';
    let isLoginMode = true;
    let editingPostId = null;
    let currentEditingId = null;
    let allPdfFiles = [];
    let availableSubjects = [];
    let availableExams = [];
    let availableGeneralBooks = [];
    let availableBlogCategories = [];
    let currentAssignTarget = { type: null, id: null, field: null };
    let currentPdfToAssign = { path: null, name: null };
    let postToDeleteId = null;
    let commentToReplyId = null;
    let allPosts = [];
    let allComments = [];
    let quill, tagify, schedulePicker, reportDatePicker;
    let activeManagers = { subjects: null, exams: null, generalBooks: null, pdfLibrary: null, quiz: null, users: null, blogPosts: null, blogCategories: null, blogComments: null, blogAnalytics: null, reports: null, dashboard: null };
    let commonListenersAttached = false; // Flag to prevent duplicate listeners

    // --- DOM ELEMENTS (Consolidated) ---
    // ... (DOM elements remain the same as previous corrected code) ...
    const loginPage = document.getElementById('login-page');
    const mainApp = document.getElementById('main-app');
    const authForm = document.getElementById('auth-form');
    const authTitle = document.getElementById('auth-title');
    const authSubmitBtn = document.getElementById('auth-submit-btn');
    const authToggleLink = document.getElementById('auth-toggle-link');
    const emailInput = document.getElementById('email');
    const passwordInput = document.getElementById('password');
    const logoutBtn = document.getElementById('logout-btn');
    const authStatus = document.getElementById('auth-status');
    const allTabs = document.querySelectorAll('.tab-content');
    const allSidebarLinks = document.querySelectorAll('#sidebar .sidebar-link'); // Includes dropdown items and regular links
    const dropdownToggles = document.querySelectorAll('#sidebar .has-dropdown'); // Only dropdown toggle buttons
    const mobileMenuBtn = document.getElementById('mobile-menu-btn');
    const mainSidebar = document.getElementById('sidebar');
    const sidebarOverlay = document.getElementById('sidebar-overlay');
    const toast = document.getElementById('toast');
    const modal = document.getElementById('modal'); // Generic CRUD Modal
    const modalContent = document.getElementById('modal-content');
    const userModal = document.getElementById('user-modal'); // Specific user modal
    const userForm = document.getElementById('user-form');
    const userModalCloseBtn = document.getElementById('user-modal-close');
    const userCancelBtn = document.getElementById('cancel-btn'); // In user modal
    const confirmActionModal = document.getElementById('confirm-modal'); // Generic confirm
    const confirmCancelBtn = document.getElementById('confirm-cancel-btn');
    // Blog Modals
    const deleteModal = document.getElementById('delete-modal');
    const cancelDeleteBtn = document.getElementById('cancel-delete-btn'); // In Blog Delete Modal
    const confirmDeleteBtn = document.getElementById('confirm-delete-btn'); // In Blog Delete Modal
    const replyModal = document.getElementById('reply-modal');
    const replyForm = document.getElementById('reply-form');
    const cancelReplyBtn = document.getElementById('cancel-reply-btn'); // In Blog Reply Modal
    const shareModal = document.getElementById('share-modal');
    const cancelShareBtn = document.getElementById('cancel-share-btn'); // In Blog Share Modal
    const copyUrlBtn = document.getElementById('copy-url-btn'); // In Blog Share Modal
    // Specific elements for each section
    const userTableBody = document.getElementById('user-table-body');
    const pdfListTable = document.getElementById('pdf-list-table');
    const postsTableBody = document.getElementById('posts-table-body'); // Blog posts
    const commentsListView = document.getElementById('comments-list'); // Blog comments
    const categoriesList = document.getElementById('categories-list'); // Blog categories
    const addCategoryForm = document.getElementById('add-category-form'); // Blog category form
    // ... add others as needed, ensuring IDs match HTML ...


    // --- UTILS ---
    const showToast = (message, type = 'success') => { toast.textContent = message; toast.className = `toast-${type}`; toast.classList.add('show'); setTimeout(() => toast.classList.remove('show'), 4000); };
    const showModal = (html) => { modalContent.innerHTML = html; modal.classList.remove('hidden'); attachFileInputListeners(); };
    const hideModal = () => { modal.classList.add('hidden'); modalContent.innerHTML = ''; currentEditingId = null; };
    const formatDate = (date) => { if (!date) return 'N/A'; const d = date.toDate ? date.toDate() : new Date(date); if (isNaN(d.getTime())) return 'Invalid Date'; return d.toLocaleDateString('en-US', { year: 'numeric', month: 'short', day: 'numeric' }); };
    const formatBytes = (bytes, decimals = 2) => { if (!bytes || bytes === 0) return '0 Bytes'; const k = 1024; const dm = decimals < 0 ? 0 : decimals; const sizes = ['Bytes', 'KB', 'MB', 'GB', 'TB']; const i = Math.floor(Math.log(bytes) / Math.log(k)); return parseFloat((bytes / Math.pow(k, i)).toFixed(dm)) + ' ' + sizes[i]; };
    async function mockUploadFile(file) { showToast(`Simulating upload for ${file.name}...`); await new Promise(resolve => setTimeout(resolve, 500)); const mockUrl = `https://mockstorage.com/${Date.now()}-${file.name.replace(/\s+/g, '_')}`; console.log(`Mock Upload: ${file.name} -> ${mockUrl}`); return { name: file.name, url: mockUrl }; }

    // --- MASTER AUTHENTICATION ---
    onAuthStateChanged(auth, (user) => {
        console.log("onAuthStateChanged fired. User:", user ? user.email : 'null');
        if (user) {
            currentUser = user;
            authStatus.textContent = `Logged in as ${user.email}`;
            authStatus.className = 'text-xs text-green-400 truncate mb-2';
            mainApp.classList.remove('hidden');
            loginPage.classList.add('hidden');
            if (!commonListenersAttached) {
                initializeAppLogic();
                commonListenersAttached = true;
            } else {
                switchTab(currentActiveTab || 'dashboard');
            }
        } else {
            currentUser = null;
            authStatus.textContent = 'Not Authenticated';
            authStatus.className = 'text-xs text-red-400 truncate mb-2';
            mainApp.classList.add('hidden');
            loginPage.classList.remove('hidden');
            stopAppLogic();
            commonListenersAttached = false;
        }
        lucide.createIcons();
    });

    const handleAuthForm = async (e) => {
        e.preventDefault();
        console.log("Auth form submitted!");
        const email = emailInput.value;
        const password = passwordInput.value;
        authSubmitBtn.disabled = true;
        authSubmitBtn.textContent = 'Processing...';
        const action = isLoginMode ? signInWithEmailAndPassword : createUserWithEmailAndPassword;
        try {
            const userCredential = await action(auth, email, password);
            console.log("Firebase auth successful:", userCredential.user.uid);
             if (!isLoginMode) {
                 console.log("Creating Firestore user doc for new user:", userCredential.user.uid);
                 await setDoc(doc(db, "users", userCredential.user.uid), {
                    uid: userCredential.user.uid, name: email.split('@')[0], email: email,
                    phone: '', role: 'student', paymentStatus: 'not_paid', createdAt: serverTimestamp(), banned: false
                });
             }
            // onAuthStateChanged handles UI switch
        } catch (error) {
            console.error("Firebase auth error:", error);
            showToast(error.message, "error");
            authSubmitBtn.disabled = false; // Re-enable only on error
            authSubmitBtn.textContent = isLoginMode ? 'Sign in' : 'Sign up';
        }
    };

    const toggleAuthMode = (e) => { e.preventDefault(); isLoginMode = !isLoginMode; authTitle.textContent = isLoginMode ? 'Sign in' : 'Create account'; authSubmitBtn.textContent = isLoginMode ? 'Sign in' : 'Sign up'; authToggleLink.textContent = isLoginMode ? "Need account? Sign up" : 'Have account? Sign in'; };
    const handleLogout = async () => { try { await signOut(auth); } catch (error) { console.error("Logout Error:", error); showToast(error.message, "error"); } };

    // --- MASTER NAVIGATION & LISTENER MANAGEMENT ---
    const stopAllManagers = () => { console.log("Stopping all managers..."); Object.keys(activeManagers).forEach(key => { if (activeManagers[key]?.stop) { try { activeManagers[key].stop(); console.log(`Stopped manager: ${key}`); } catch (e) { console.error(`Error stopping ${key}:`, e); } } activeManagers[key] = null; }); if (typeof unsubscribePosts === 'function') unsubscribePosts(); if (typeof unsubscribeComments === 'function') unsubscribeComments(); if (typeof unsubscribeCategories === 'function') unsubscribeCategories(); unsubscribePosts = unsubscribeComments = unsubscribeCategories = () => {}; };

    const switchTab = (tabId) => {
        console.log(`Attempting to switch to tab: ${tabId}`);
        stopAllManagers();
        currentActiveTab = tabId;

        allTabs.forEach(tab => tab.classList.add('hidden'));
        const newTab = document.getElementById(tabId);
        if (newTab) {
            newTab.classList.remove('hidden');
        } else {
            console.warn(`Tab "${tabId}" not found. Defaulting to dashboard.`);
            document.getElementById('dashboard')?.classList.remove('hidden'); // Use optional chaining
            currentActiveTab = 'dashboard';
            tabId = 'dashboard';
        }

        allSidebarLinks.forEach(link => link.classList.remove('active'));
        dropdownToggles.forEach(btn => { btn.classList.remove('open', 'active'); const menu = btn.nextElementSibling; if (menu?.classList.contains('dropdown-menu')) menu.style.display = 'none'; const icon = btn.querySelector('.dropdown-icon'); if (icon) icon.style.transform = 'rotate(0deg)'; });

        const activeLink = document.querySelector(`#sidebar .sidebar-link[data-tab="${tabId}"]`);
        if (activeLink) {
            activeLink.classList.add('active');
            const parentMenu = activeLink.closest('.dropdown-menu');
            if (parentMenu) {
                const parentBtn = parentMenu.previousElementSibling;
                if (parentBtn?.classList.contains('has-dropdown')) {
                    parentBtn.classList.add('open', 'active'); parentMenu.style.display = 'block'; const icon = parentBtn.querySelector('.dropdown-icon'); if (icon) icon.style.transform = 'rotate(180deg)';
                }
            }
        } else {
             console.warn(`Sidebar link for tab "${tabId}" not found.`);
             document.querySelector(`#sidebar .sidebar-link[data-tab="dashboard"]`)?.classList.add('active'); // Fallback to dashboard link
        }

        console.log(`Starting manager for: ${tabId}`);
        // --- Initialize logic/listeners for the new tab ---
        switch (tabId) {
            case 'dashboard': activeManagers.dashboard = startDashboardManager(); break;
            case 'subjects': activeManagers.subjects = managers.subjects.start(); break;
            case 'exams': activeManagers.exams = managers.exams.start(); break;
            case 'generalBooks': activeManagers.generalBooks = managers.generalBooks.start(); break;
            case 'quizzes': activeManagers.quiz = startQuizManager(); break;
            case 'pdf-library': activeManagers.pdfLibrary = startPdfLibraryManager(); break;
            case 'list-posts': initPostsListener(); initCategoriesListener(); break;
            case 'post-form-view': initCategoriesListener(); if (!editingPostId) showPostForm(); else showPostForm(editingPostId); break;
            case 'categories': initCategoriesListener(renderCategoriesList); break;
            case 'comments': initPostsListener(); initCommentsListener(); break;
            case 'analytics': fetchAllDataForAnalytics(); break;
            case 'users-students': activeManagers.users = startUserManager(); break;
            case 'users-roles': initUsersListener(renderAdminList); console.log(`Tab "${tabId}" - Placeholder`); break;
            case 'main-report': if (reportDatePicker) reportDatePicker.destroy(); reportDatePicker = flatpickr("#report-date-range", { mode: "range", dateFormat: "Y-m-d" }); console.log(`Tab "${tabId}" - Placeholder`); break;
            case 'settings': console.log(`Tab "${tabId}" - Placeholder`); break;
            default: console.warn(`No manager defined for tab: ${tabId}`);
        }
        lucide.createIcons();
    };

    // --- APP INITIALIZATION & SHUTDOWN ---
    const initializeAppLogic = () => { console.log("Initializing app logic..."); fetchSubjectsForDropdown(); fetchBlogCategoriesForDropdown(); initBlogLibs(); setupCommonEventListeners(); switchTab(currentActiveTab || 'dashboard'); };
    const stopAppLogic = () => { console.log("Stopping app logic..."); stopAllManagers(); if (quill) quill = null; if (tagify) tagify.destroy(); tagify = null; if (schedulePicker) schedulePicker.destroy(); schedulePicker = null; if (reportDatePicker) reportDatePicker.destroy(); reportDatePicker = null; };

    // --- Setup Common Event Listeners ---
    function setupCommonEventListeners() {
        console.log("Setting up common event listeners...");
        // **FIXED: Sidebar Dropdowns** - Add listener directly
        dropdownToggles.forEach(button => {
            button.addEventListener('click', (e) => {
                const targetButton = e.currentTarget;
                const dropdownMenu = targetButton.nextElementSibling;
                const icon = targetButton.querySelector('.dropdown-icon');
                const isOpen = targetButton.classList.contains('open');
                console.log(`Dropdown toggle clicked: ${targetButton.textContent.trim()}, Currently Open: ${isOpen}`); // Debug log

                // Close others first
                dropdownToggles.forEach(otherBtn => { if (otherBtn !== targetButton && otherBtn.classList.contains('open')) { otherBtn.classList.remove('open', 'active'); otherBtn.nextElementSibling.style.display = 'none'; const otherIcon = otherBtn.querySelector('.dropdown-icon'); if(otherIcon) otherIcon.style.transform = 'rotate(0deg)'; } });

                // Toggle clicked
                targetButton.classList.toggle('open');
                dropdownMenu.style.display = isOpen ? 'none' : 'block';
                if(icon) icon.style.transform = isOpen ? 'rotate(0deg)' : 'rotate(180deg)';
                // Don't add 'active' to parent toggle on click, only when child is selected (handled in switchTab)
            });
        });

        // Sidebar Links (All links, including those in dropdowns)
        allSidebarLinks.forEach(link => {
            // Skip dropdown toggle buttons
            if (link.classList.contains('has-dropdown')) return;

            link.addEventListener('click', (e) => {
                e.preventDefault();
                const targetLink = e.currentTarget;
                const tabId = targetLink.dataset.tab;
                console.log(`Sidebar link clicked: ${tabId}`);

                if (tabId) {
                    if (tabId === 'post-form-view' && targetLink.dataset.action === 'add') editingPostId = null;
                    switchTab(tabId);
                } else { console.warn("Link missing data-tab:", targetLink); }

                if (window.innerWidth < 768 && !mainSidebar.classList.contains('-translate-x-full')) toggleSidebar();
            });
        });

        // Mobile Sidebar Toggle
        mobileMenuBtn.onclick = toggleSidebar;
        sidebarOverlay.onclick = toggleSidebar;
        // Logout Button
        logoutBtn.onclick = handleLogout;
        // Generic CRUD Modal Cancel/Background Click
        modal.addEventListener('click', (e) => { if (e.target.classList.contains('modal-cancel-btn') || e.target === modal) { hideModal(); } });
        // Generic CRUD Modal Form Submission
        modal.addEventListener('submit', (e) => { if (e.target.id === 'crud-form') { const type = e.target.dataset.type; if (managers[type]?.handleFormSubmit) managers[type].handleFormSubmit(e); else console.warn(`No submit handler for CRUD type: ${type}`); } });
        // Global Add Button handler
        document.body.addEventListener('click', (e) => { const addBtn = e.target.closest('.add-btn'); if (addBtn) { const type = addBtn.dataset.type; if (managers[type]?.handleAdd) managers[type].handleAdd(); else console.warn(`No add handler for CRUD type: ${type}`); } });
        // Assign PDF Modals Listeners
        document.getElementById('assign-modal-cancel').addEventListener('click', closeAssignModal);
        document.getElementById('assign-pdf-search').addEventListener('input', renderAssignablePdfs);
        document.getElementById('assign-pdf-to-content-modal-cancel').addEventListener('click', closeAssignPdfToContentModal);
        document.querySelectorAll('.assign-pdf-select-type-btn').forEach(btn => btn.addEventListener('click', (e) => { const type = e.currentTarget.dataset.type; document.querySelectorAll('.assign-pdf-select-type-btn').forEach(b => b.classList.remove('bg-indigo-100', 'text-indigo-700')); e.currentTarget.classList.add('bg-indigo-100', 'text-indigo-700'); document.getElementById('assign-content-search').value = ''; renderAssignableContent(type); }));
        document.getElementById('assign-content-search').addEventListener('input', (e) => { const activeBtn = document.querySelector('.assign-pdf-select-type-btn.bg-indigo-100'); if (activeBtn) renderAssignableContent(activeBtn.dataset.type); });
        // User Modals Listeners
        userModalCloseBtn.addEventListener('click', () => closeModal(userModal));
        userCancelBtn.addEventListener('click', () => closeModal(userModal));
        confirmCancelBtn.addEventListener('click', () => hideConfirmModal());
        // Blog specific modals listeners (attach here since modals exist globally)
        setupBlogEventListeners();
    }
    const toggleSidebar = () => { mainSidebar.classList.toggle('-translate-x-full'); sidebarOverlay.classList.toggle('hidden'); };

    // --- Authentication Form Listeners (outside common setup) ---
    authForm.addEventListener('submit', handleAuthForm);
    authToggleLink.addEventListener('click', toggleAuthMode);

    // --- DASHBOARD MANAGER ---
    const startDashboardManager = () => { /* ... unchanged ... */ }; // Includes console logs

    // --- PDF / CONTENT MANAGER ---
    const uploadFileToStorage = (file, pathPrefix) => new Promise((resolve, reject) => { /* ... unchanged ... */ });
    const attachFileInputListeners = () => { /* ... unchanged ... */ };
    const createTableHTML = (id, title, headers) => { /* HTML structure unchanged */ return `...`; }; // Keep HTML structure
    const createCrudManager = (config) => { /* ... unchanged ... */ }; // Includes console logs
    const fetchSubjectsForDropdown = async () => { /* ... unchanged ... */ }; // Includes console logs
    const fetchBlogCategoriesForDropdown = async () => { /* ... unchanged ... */ }; // Includes console logs
    const managers = { // Define managers object
        subjects: createCrudManager({ type: 'subjects', title: 'Subjects', headers: ['Cover', 'Name', 'Grade', 'Book PDF', 'Created'], fields: [ { id: 'name', label: 'Subject Name', required: true }, { id: 'grade', label: 'Grade (e.g., F1, F2)', required: true }, { id: 'coverImage', label: 'Cover Image', type: 'file', accept: 'image/*', uploadPath: 'subject_covers/' }, { id: 'bookPdfUrl', label: 'Book PDF/ZIP', type: 'file', accept: '.pdf,.zip', uploadPath: 'subject_pdfs/' } ], renderRow: (item) => `...` /* Row HTML unchanged */ }),
        exams: createCrudManager({ type: 'exams', title: 'Exams', headers: ['Cover', 'Name', 'Year', 'Subject', 'PDF', 'Created'], fields: [ { id: 'name', label: 'Exam Name', required: true }, { id: 'year', label: 'Year', type: 'number', required: true }, { id: 'subjectId', label: 'Subject', type: 'select', optionsSource: 'subjects', required: true }, { id: 'coverImage', label: 'Cover Image', type: 'file', accept: 'image/*', uploadPath: 'exam_covers/' }, { id: 'pdfUrl', label: 'Exam PDF/ZIP', type: 'file', accept: '.pdf,.zip', uploadPath: 'exam_pdfs/' } ], renderRow: (item) => { /* Row HTML unchanged */ return `...`; } }),
        generalBooks: createCrudManager({ type: 'generalBooks', title: 'General Books', headers: ['Cover', 'Title', 'Author', 'PDF', 'Created'], fields: [ { id: 'title', label: 'Book Title', required: true }, { id: 'author', label: 'Author' }, { id: 'coverImageUrl', label: 'Cover Image', type: 'file', accept: 'image/*', uploadPath: 'generalBooks_covers/' }, { id: 'pdfUrl', label: 'Book PDF/ZIP', type: 'file', accept: '.pdf,.zip', uploadPath: 'generalBooks_pdfs/' } ], renderRow: (item) => `...` /* Row HTML unchanged */ }),
        // Blog managers handled separately
    };

    // --- PDF LIBRARY MANAGER ---
    const startPdfLibraryManager = () => { /* ... unchanged ... */ }; // Includes console logs
    // Assign PDF Modals functions remain unchanged
    const assignModal = document.getElementById('assign-modal');
    const assignItemNameEl = document.getElementById('assign-item-name');
    const assignItemTypeEl = document.getElementById('assign-item-type');
    const assignPdfListContainerEl = document.getElementById('assign-pdf-list-container');
    const assignPdfSearchEl = document.getElementById('assign-pdf-search');
    const assignPdfToContentModal = document.getElementById('assign-pdf-to-content-modal');
    const assignPdfNameDisplay = document.getElementById('assign-pdf-name-display');
    const assignContentSearchEl = document.getElementById('assign-content-search');
    const assignContentListContainerEl = document.getElementById('assign-content-list-container');
    const openAssignModal = (type, id, field, name) => { /* ... unchanged ... */ };
    const closeAssignModal = () => { /* ... unchanged ... */ };
    const renderAssignablePdfs = () => { /* ... unchanged ... */ };
    const assignPdf = async (path) => { /* ... unchanged ... */ };
    const openAssignPdfToContentModal = (path, name) => { /* ... unchanged ... */ };
    const closeAssignPdfToContentModal = () => { /* ... unchanged ... */ };
    const renderAssignableContent = (type) => { /* ... unchanged ... */ };
    const assignPdfToContent = async (type, id, field) => { /* ... unchanged ... */ };

    // --- QUIZ MANAGER ---
    const startQuizManager = () => { /* ... unchanged ... */ }; // Includes console logs

    // --- USER MANAGER ---
    const startUserManager = () => { /* ... unchanged ... */ }; // Includes console logs

    // --- BLOG MANAGER ---
    // Listeners
    let unsubscribePosts = () => {}; let unsubscribeComments = () => {}; let unsubscribeCategories = () => {};
    function initPostsListener() { /* ... unchanged ... */ };
    function initCommentsListener() { /* ... unchanged ... */ };
    function initCategoriesListener(callback) { /* ... unchanged ... */ };
    async function fetchAllDataForAnalytics() { /* ... unchanged ... */ };
    // Init Libs
    function initBlogLibs() { /* ... unchanged ... */ };
    // Rendering
    function renderPostsTable() { /* HTML unchanged */ /* ... function logic unchanged ... */ };
    function renderCommentsList() { /* HTML unchanged */ /* ... function logic unchanged ... */ };
    function renderCategoriesList() { /* HTML unchanged */ /* ... function logic unchanged ... */ };
    function updateBlogCategoryDropdowns() { /* ... function logic unchanged ... */ };
    function renderAnalytics() { /* ... function logic unchanged ... */ };
    // Form/Actions
    async function showPostForm(postId = null) { /* ... function logic unchanged ... */ };
    async function handleBlogPostFormSubmit(e) { /* ... function logic unchanged ... */ };
    async function handleImageUpload(file) { /* ... function logic unchanged ... */ };
    function addAttachmentToList(fileName, fileUrl) { /* HTML unchanged */ /* ... function logic unchanged ... */ };
    async function handleAttachmentUpload(files) { /* ... function logic unchanged ... */ };
    function showDeleteModal(postId) { /* ... function logic unchanged ... */ };
    async function confirmDelete() { /* ... function logic unchanged ... */ };
    async function updateCommentStatus(commentId, newStatus) { /* ... function logic unchanged ... */ };
    async function deleteComment(commentId) { /* ... function logic unchanged ... */ };
    function showReplyModal(commentId) { /* ... function logic unchanged ... */ };
    async function handleReplySubmit(e) { /* ... function logic unchanged ... */ };
    function showShareModal(postId, postTitle) { /* ... function logic unchanged ... */ };
    // Blog Event Listeners Setup
    function setupBlogEventListeners() { /* ... unchanged ... */ }; // Includes console logs

    // --- Global App Object ---
    window.app = { // Ensure this is accessible for inline onclicks
        editItem: (type, id) => {
            let item = null; const manager = managers[type]; // Find the specific CRUD manager
            if (manager && manager.localItems) item = manager.localItems.find(i => i.id === id); // Use its local cache
            else if (type === 'blogCategories') item = availableBlogCategories.find(i => i.id === id); // Specific cache for blog categories
            // Blog posts edit is handled by showPostForm, not generic CRUD modal
            if (item && manager?.handleEdit) manager.handleEdit(item);
            else if (type !== 'blogPosts') { console.error(`Cannot edit item ${id} of type ${type}`); showToast("Could not find item data.", "error"); }
        },
        deleteItem: (type, id) => { if (managers[type]?.handleDelete) managers[type].handleDelete(id); else console.error(`No delete handler for ${type}`); },
        copyToClipboard: async (path) => { try { const url = await getDownloadURL(ref(storage, path)); navigator.clipboard.writeText(url); showToast("URL copied!"); } catch (e) { console.error("Copy URL error:", e); showToast("Could not copy URL.", "error"); } },
        deletePdf: async (path) => { if (confirm(`Delete this file?\n${path}\nCannot be undone.`)) { try { await deleteObject(ref(storage, path)); showToast("File deleted!"); allPdfFiles = allPdfFiles.filter(p => p.fullPath !== path); renderPdfList(); } catch (e) { console.error("Delete file error:", e); showToast("Error deleting file.", "error"); } } }, // Added renderPdfList call
        openAssignModal: (type, id, field, name) => { openAssignModal(type, id, field, name); },
        assignPdf: (path) => { assignPdf(path); },
        openAssignPdfToContentModal: (path, name) => { openAssignPdfToContentModal(path, name); },
        assignPdfToContent: (type, id, field) => { assignPdfToContent(type, id, field); }
    };

    // --- Initial DOM Ready ---
     document.addEventListener('DOMContentLoaded', () => {
         console.log("DOM Loaded.");
         lucide.createIcons();
         // Auth state change triggers app initialization
     });

</script>
</body>
</html>
